<form id="edit-img-form">
	<div class="form-group">
		<img id="cropper" />
	</div>
	<div class="form-group d-flex justify-content-end" style="margin-bottom: 0px !important">
		<button type="submit" class="btn btn-default close-button mr-3" data-dismiss="modal">
			<span class="icon text-black-50">
				<i class="fas fa-times"></i>
			</span>
			Відмінити
		</button>
		<a class="btn btn-success" id="save-btn">
			<span class="icon text-white-50">
				<i class="fas fa-check"></i>
			</span>
			Зберегти
		</a>
	</div>
</form>

<script>
	$(document).ready(function () {
		var $uploadCrop;

		readFile($('#customFile'));
		$uploadCrop = $('#cropper').croppie({
			viewport: {
				width: 500,
				height: 500,
				type: 'square'
			},
			boundary: {
				width: 600,
				height: 600
			},
			showZoomer: false,
			enforceBoundary: true,
			enableExif: true
		});

		function readFile(input) {
			var reader = new FileReader();

			reader.onload = function (e) {
				$uploadCrop.croppie('bind', {
					url: e.target.result
				})
			}
			reader.readAsDataURL(input[0].files[0]);
		}

		$("#save-btn").on('click', function () {
			try {
				$uploadCrop.croppie('result', {
					type: 'blob',
					size: {
						width: 640,
						height: 640
					}
				}).then(function (blob) {
					var formData = new FormData();
					formData.append('id', '@Model');
					formData.append('fileName', $('#customFile').val());
					formData.append('blob', blob);

					try {
						$.ajax({
							type: 'POST',
							url: '/Admin/Profile/ChangeProfileImage',
							data: formData,
							contentType: false,
							processData: false,
							success: function (res) {
								if (res.isValid) {
									$('#form-modal').modal('hide');
								}
							},
							error: function (err) {
								console.log(err)
							}
						}).done(function () {
							var urlCreator = window.URL || window.webkitURL;
							$("#profilePicture").attr('src', urlCreator.createObjectURL(blob));
							$("#del-img").removeClass("disabled");
						});
					} catch (ex) {
						console.log(ex)
					}
				});
			} catch (e) {
				console.log(e);
			}
		});

	});
</script>
